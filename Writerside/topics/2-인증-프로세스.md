# 2_인증_프로세스

## 폼 인증 - formLogin()
### 폼 인증
- 사용자 인증을 위한 사용자 정의 로그인 페이지 구현 가능
- 간단한 로그인 양식(이름/비밀번호)을 제공한다
- 사용자는 웹 폼을 통해 자격 증명을 하고 Spring Security는 HttpServletRequest 에서 이 값을 읽는다

### 폼 인증 흐름
![스크린샷 2024-07-17 19.13.23.png](스크린샷_2024-07-17_19.13.23.png)

### formLogin() API 
- UsernamePasswordAuthenticationFilter 에서 처리
- apis
  - loginProcessingUrl() : 로그인 인증 URL. (default : /login)
  - failureUrl() : 인증 실패 리다이렉트 URL. (default : /login?error)
  - defaultSuccessUrl() : alwaysUse(default: false) true 시 지정된 위치로 이동 
  - failureHandler() : 인증 실패 시 사용할 AuthenticationFailureHandler 지정
  - successHandler() : 인증 성공 시 사용 AuthenticationSuccessHandler 지정

## 폼 인증 필터 - UsernamePasswordAuthenticationFilter
### 개요
![스크린샷 2024-07-17 19.45.20.png](스크린샷_2024-07-17_19.45.20.png)
- AbstractAuthenticationProcessingFilter 확장클래스
- 인증 프로세스 초기화 시 로그인 & 로그아웃 페이지 생성을 위한 DefaultLoginPageGeneratingFilter, DefaultLogoutPageGeneratingFilter 초기화
### 흐름도
![스크린샷 2024-07-17 19.52.14.png](스크린샷_2024-07-17_19.52.14.png)

## Http Basic 인증
### 개요
![스크린샷 2024-07-22 19.31.51.png](스크린샷_2024-07-22_19.31.51.png)
- 가장 일반적인 인증 방식 
- RFC 7235 표준
- base64인코딩 값은 디코딩이 가능하여 보안 이슈가 있음
- 반드시 HTTPS TLS 기술과 함께 사용해야 함 

### httpBasic() API
- apis
  - realmName(): HTTP 기본영역. 보호된 영역을 식별하는 용도
  - authenticationEntryPoint(): 인증 entrypoint 설정 (default "realm" BasicAuthenticationEntryPoint)

### BasicAuthenticationFilter
![스크린샷 2024-07-22 19.49.50.png](스크린샷_2024-07-22_19.49.50.png)
- 기본 인증 서비스 제공 필터
- BasicAuthenticationConverter 사용하여 요청 헤더 인증 정보의 유효성을 체크, Base64 인코딩된 username, password를 추출
- 세션 사용 유무에 따라 처리 과정이 다름
- 세션을 사용하는 경우 매 요청마다 인증과정을 거치지 않음(기본은 request 단위이므로 요청 시마다 인증과정을 거침)

## 기억하기 RememberMe 인증
### 개요
- 사용자 로그인 시 자동으로 인증정보를 기억하는 기능
- UsernamePasswordAuthenticationFilter와 사용, AbstractAuthenticationProcessingFilter 슈퍼클래스에서 훅을 통해 구현
  - 성공 시 : RememberMeService.loginSuccess()을 통해  RememberMe 토큰 생성하여 쿠키로 전달
  - 실패 시 : RememberMeService.loginFail()을 통해 쿠키를 지움 
  - LogoutFilter와 연계해서 로그아웃 시 쿠키를 지움

### 토큰 생성
- base64(username + ":" + expirationTime + ":" + algorithmName + ":" +algorithmHex())"
- 기본적으로 SHA-256 알고리즘 사용

### RememberMeServices 구현체 
- TokenBasedRememberMeService : 쿠키 기반 토큰의 보안을 위해 해싱을 사용
- PersistenceTokenBasedRememberMeServices : 생성된 토큰을 저장하기 위해 데이터베이스나 다른 영구 저장 매체를 사용
- 두 구현 모두 사용자 정보 검색을 위한 UserDetailsService가 필요

### rememberMe() API
- alwaysRemember(): 매개변수 설정되지 않았을 때에도 쿠키가 항상 생성되어야 하는지 여부
- tokenValiditySeconds(): 토큰 유효 시간(초)
- userDetailService(): UserDetails 조회하기 위함
- rememberMeParameter(): default(remember-me)
- rememberMeCookieName(): default(remember-me)
- key(): 토큰 식별 키

## RememberMeAuthenticationFilter
![스크린샷 2024-07-22 20.16.29.png](스크린샷_2024-07-22_20.16.29.png)
- SecurityContextHolder에 Authentication이 포함되지 않은 경우 실행되는 필터
- 세션 만료 또는 어플레키엿ㄴ 종료로 인해 인증 상태가 소멸된 경우 토큰 유효성 검사를 통해 자동 로그인 처리

